-- fn_validate_plate.sql
CREATE OR REPLACE FUNCTION fn_validate_plate(p_plate IN VARCHAR2) RETURN BOOLEAN IS
  v_ok BOOLEAN := FALSE;
  v_err_code NUMBER;
  v_err_msg  VARCHAR2(4000);
BEGIN
  IF p_plate IS NULL THEN
    RETURN FALSE;
  END IF;

  -- Example rule: letters/digits and optional hyphens, 3..12 chars
  IF REGEXP_LIKE(TRIM(p_plate), '^[A-Z0-9-]{3,12}$', 'i') THEN
    v_ok := TRUE;
  ELSE
    v_ok := FALSE;
  END IF;

  RETURN v_ok;

EXCEPTION
  WHEN OTHERS THEN
    v_err_code := SQLCODE;
    v_err_msg  := SQLERRM;
    BEGIN
      INSERT INTO ERROR_LOG(object_name, action, err_code, err_msg, details)
      VALUES('fn_validate_plate','validate', v_err_code, v_err_msg, 'plate='||NVL(p_plate,'NULL'));
      COMMIT;
    EXCEPTION WHEN OTHERS THEN NULL; END;
    RETURN FALSE;
END fn_validate_plate;
/

